<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Classic Chat Interface</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.4.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
    font-family: Arial, sans-serif;
    background-color: #ffff;
    margin: 0;
    padding: 1rem;
    padding-top: 1.5rem;
    height: 100vh;
    justify-content: center;
    align-items: center;
    overflow: hidden; /* Disable scrolling */
}
.chat-container {
    border-radius: 1rem;
    background-color: #fff;
    height: calc(95vh - 110px); /* Subtracting padding and margin */
    overflow-y: auto; /* Enable vertical scrolling */
    margin: 0 auto;/* Center the container horizontally */
    overflow-x: auto; /* Or any overflow value if needed */
  overflow-wrap: break-word; /* Wrap long words */
   padding-top: 15px;
   
      
}
/* For mobile devices (up to 576px) */
@media (max-width: 576px) {
    .chat-container {
        width: 100%; /* Full width on mobile */
        max-width: none; /* No maximum width */
        margin: 0 auto; /* Center the container horizontally */
        overflow-x: hidden; /* Prevent horizontal scrolling */
    }
}

/* For tablets (between 577px and 992px) */
@media (min-width: 577px) and (max-width: 992px) {
    .chat-container {
        width: 90%; /* 90% width on tablets */
        max-width: none; /* No maximum width */
        padding: 1.5rem; /* Adjust padding as needed */
        margin: 0 auto; /* Center the container horizontally */
        overflow-x: hidden; /* Prevent horizontal scrolling */
    }
}



/* For laptops and desktops (992px and above) */
@media (min-width: 993px) {
    .chat-container {
        width: 750px; /* Specific width for laptops/desktops */
        max-width: 100%; /* Allow container to be smaller than 750px if needed */
        padding: 2rem; /* Adjust padding as needed */
        margin: 0 auto; /* Center the container horizontally */
    }
}
#user-message {
    background-color: #f0f4f9; /* Light blue background for user messages */
    padding: 18px;
    border-radius: 5px;
    margin-bottom: 10px;
    margin-left: 2%;
}

#response-message { 
    padding: 10px;
    border-radius: 5px;
    margin-bottom: 8px;
}
.additional-question {
    position: relative;
    padding: 10px;
    border-radius: 5px;
    margin-bottom: 10px;
    overflow: hidden; /* Ensure relative positioning for the ::after pseudo-element */
    list-style-type: none;
    background-color: #f4f5f5;

}
.additional-question::before {
    content: " "; /* Empty content to avoid showing "Additional Question:" */
    display: block;
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 1; /* Ensure it's above the actual content */
   
}
.additional-question p {
    margin: 0px; /* Remove default margin for paragraph */
    z-index: 2; /* Ensure it's below the pseudo-element */
   
}
.additional-question::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 2px; /* Adjust the height of the line as needed */
    background-color:  #7b7777; /* Black color for the line */
}

#history-sidebar {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    bottom: 0;
    width: 200px;
    padding: 20px;
    background-color:  #f0f4f9; 
    border-right: 1px solid #ccc;
    z-index: 1000;
    padding-left: 0%;
    
}
.sidebar-opened #history-sidebar {
    display: block;
}
.input-group {
    width: 100%; /* Set width for the input group */
    display: flex;
    align-items: center;
    
}
.input-group {
    position: relative; /* Set position to relative */
}

.form-control {
    flex: 2; /* Use all available space */ 
    border: 2px solid #5a5959;
    transition: width 0.3s, border-color 0.3s;
    height: 50px; /* Set your desired height */
    padding: 12px;
    font-size: 12px;
    border: 1px solid #ccc;
    border-radius: 9px;
    box-sizing: border-box;

}
.form-control:focus {
    outline: none;
    border-color: #942bc5;
    transition: width 0.3s, border-color 0.3s;
}
/* For mobile devices (up to 576px) */
@media (max-width: 576px) {
    .input-group {
        margin-bottom: 60%;
    }

    .form-control {
        width: 100%; /* Full width for form control */
        
    }
}

/* For tablets (between 577px and 992px) */
@media (min-width: 577px) and (max-width: 992px) {
    .input-group {
        margin-bottom: 6rem;
        width: 100%; /* Full width on tablets */
       
    }

    .form-control {
        width: 100%; /* Full width for form control */
        
    }
}

/* For laptops and desktops (992px and above) */
@media (min-width: 993px) {
    .input-group {
        margin-bottom: 6rem; /* Adjust margin as needed */
        margin-left: 80px; /* Restore left margin for laptops/desktops */
        width: calc(100% - 120px); /* Adjust width for laptops/desktops */
        padding: 0; /* Reset padding */
    }

    .form-control {
        width: calc(100% - 120px); /* Adjust width for form control */
        margin-right: 0; /* Reset right margin */
        
    }
}
.btn-primary {
    background-color:  #f0f4f9; 
    border-radius: 20px;
    padding: 10px 20px;
    border: none;
    transition: background-color 0.3s, border-color 0.3s;
    width: 100%; /* Make buttons take full width */
    text-align: left; /* Align button text to left */
}
.btn-primary:hover {
    background-color:  #f0f4f9; 
}
.btn-primary1 {
    background-color: #ffff;
    border-radius: 20px;
    padding: 3px 3px;
    border: none;
    transition: background-color 0.3s, border-color 0.3s;
}
.btn-link {
    color: #3498db;
    text-decoration: none;
    transition: color 0.3s;
}
.btn-link:hover {
    text-decoration: underline;
    color: #2980b9;
}
.footer-buttons {
    position: fixed;
    bottom: 20px;
    right: 20px;
    z-index: 1000;
}
#open-sidebar-btn {
    position: fixed;
    top: 3px;
    left: 3px;
    z-index: 1000;
}
.close-sidebar-btn {
    position: absolute;
    top: 20px;
    right: 20px;
}
.sidebar-opened .form-control {
    width: 50px;
}
#new {
    padding-top: 10dvh;
}
#account {
    padding-top: 20dvh;
}
#button-container {
    position: absolute; /* Position the button container absolutely */
    right: 0; /* Align to the right */
    top: 50%; /* Align vertically to the middle */
    transform: translateY(-50%); /* Adjust vertical alignment */
}

.user-message {
    background-color: #e0f7fa; /* Light blue color */
    padding: 10px;
    border-radius: 5px;
    margin-bottom: 10px;
}

#voice-command-button,
#send-button {
    margin-left: 5px; /* Add margin between buttons */
    border-radius: 20px; /* Add border radius to buttons */
}

.form-control {
    padding-right: 100px; /* Add space on the right for the buttons */
}

#send-button {
    display: inline-block; /* Ensure the button is displayed inline */
}
#audio-container {
            margin-top: 20px;
        }
        #audio-player {
            display: none; /* Hide by default */
        }
        #listen-btn {
    background: none;
    border: none;
    padding: 0;
    cursor: pointer;
}
/* Styles for loading animation */
#loading-animation {
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 20px; /* Increase margin for better spacing */
}

.dot {
    width: 15px; /* Increase dot size for better visibility */
    height: 15px; /* Increase dot size for better visibility */
    background-color: #666666;
    border-radius: 50%;
    margin: 0 5px;
    animation: bounce 1.5s infinite ease-in-out;
    opacity: 0.5; /* Reduce opacity to make dots less dominant */
}

.dot:nth-child(2) {
    animation-delay: 0.2s; /* Add delay for the second dot */
}

.dot:nth-child(3) {
    animation-delay: 0.4s; /* Add delay for the third dot */
}

@keyframes bounce {
    0%, 100% {
        transform: translateY(0);
    }
    50% {
        transform: translateY(-15px); /* Increase bounce height */
    }
}
.LOGO {
        display: flex;
        justify-content: center;
        align-items: center;
    
    }



    </style>
</head>


<body class="sidebar-opened">
    <div class="container">
        <div class="row">
            <div class="col-lg-4 col-md-6 col-sm-8">
                <div id="history-sidebar">
                    <h5>Chat History</h5>
                    <button class="close-sidebar-btn btn btn-primary" id="cross">
                        <img src="/static/img/cross-removebg-preview.png" alt="Close Sidebar" style="width: 18px; height: 18px; float: right; ">
                    </button>
                    <div class="LOGO">
                        <img src="/static/img/LOGO.png" alt="" style="width:75px;height: 75px;"></div>
                    <div id="chatHistory"></div> 
                    
                    <button class="btn btn-primary mt-3" id="clear-history-btn">
                        <img src="/static/img/chat-removebg-preview.png" alt="Clear History" style="width:25px;height: 25px;margin-right: 5px;">
                        New Chat
                    </button>
                    
                    <button class="btn btn-primary mt-3" onclick="window.location.href='history.html'" style="display: flex; align-items: center;">
                        <img src="/static/img/history-removebg-preview (1).png" alt="" style="width:25px;height: 25px;margin-right: 5px;">
                        <a href="{{ url_for('history') }}" style="color: #000;text-decoration: none;">Chat History</a>
                    </button>
                    <button class="btn btn-primary mt-3" onclick="upgrade()" style="display: flex; align-items: center;">
                        <img src="/static/img/upgrade-removebg-preview.png" alt="" style="width:25px;height: 25px;margin-right: 5px;">
                         <a href="{{ url_for('subscribe') }}" style="color: #000;text-decoration: none;">upgrade</a>
                    </button>
                    <button class="btn btn-primary mt-3" onclick="upgrade()" style="display: flex; align-items: center;">
                        <img src="\static\img\WhatsApp_Image_2024-05-28_at_00.00.01_59dfb5af-removebg-preview.png" alt="" style="width:28px;height: 30 px;margin-right: 5px;">
                         <a href="{{ url_for('support') }}" style="color: #000;text-decoration: none;">Support</a>
                    </button>
                </button>
                <button class="btn btn-primary mt-3" onclick="upgrade()" style="display: flex; align-items: center;">
                    <img src="\static\img\Privacy policy (2).jpg" alt="" style="width:28px;height: 30 px;margin-right: 5px;">
                     <a href="{{ url_for('terms') }}" style="color: #000;text-decoration: none;">T & C</a>
                </button>
            </button>
            <button class="btn btn-primary mt-3" onclick="upgrade()" style="display: flex; align-items: center;">
                <img src="\static\img\Privacy policy (1).jpg" alt="" style="width:28px;height: 30 px;margin-right: 5px;">
                 <a href="{{ url_for('privacy') }} "style="color: #000;text-decoration: none;">Privacy Policy</a>
            </button>
                    <button class="btn btn-primary mt-3" onclick="upgrade()" style="display: flex; align-items: center;">
                        <img src="\static\img\images__2_-removebg-preview.png" alt="" style="width:25px;height: 25px;margin-right: 5px;">
                         <a href="{{ url_for('logout') }}" style="color: #000;text-decoration: none;">Logout</a>
                    </button>
                    <button class="btn btn-primary mt-3" onclick="upgrade()" id="account"  style="display: flex; align-items: center;">
                        <img src="/static/img/account-removebg-preview.png" alt="" style="width:26px;height: 26px;margin-right: 5px;">
                         <a href="{{ url_for('account') }}" style="color: #000;text-decoration: none;">Account</a>
                    </button>
                </div>
            </div>




            <div class="col-lg-4 col-md-6 col-sm-8">
                <div class="chat-container">
                    <div id="chat-messages"></div>
                    <div id="loading-animation" style="display: none;">
                        <div class="dot"></div>
                        <div class="dot"></div>
                        <div class="dot"></div>
                    </div>
                    
                </div>
                <div id="fixed-question-container">
                    <form id="chat-form" class="mb-3">
                        <div class="input-group">
                            <input type="text" id="user-input" class="form-control" placeholder="Type your message..." >
                            <div id="button-container">
                                <button type="button" id="voice-command-button" class="btn btn-primary" style="background-color: transparent; ">
                                    <img src="/static/img/voice-removebg-preview final.png" alt="voice-command-button" style="width: 18px; height: 25px; margin-right: 5px;">
                                  </button>
                                  
                                <button type="submit" id="send-button" class="btn btn-primary" style="display: none;background-color: transparent;">
                                    <img src="/static/img/send-removebg-preview.png" alt="voice-command-button" style="width: 38px; height: 30px; margin-right: 0px;">
                                </button>
                            </div>
                            </div>
                            
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <button id="open-sidebar-btn" class="btn btn-primary1"style="padding: 3px;"><img src="/static/img/icon-removebg-preview (1).png" alt="open sidebar " style="height: 40px; width: 40px;">
        
    </button>    
    <div class="footer-buttons">
        <button id="close-sidebar-btn" class="btn btn-primary" style="display: none;"><img src="/static/img/cross.png" alt="Close Sidebar"></button>
    </div>



<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
<script>
$(document).ready(function() {
    const $userInput = $('#user-input');
    const $voiceButton = $('#voice-command-button');
    const $sendButton = $('#send-button');
    const $chatMessages = $('#chat-messages');
    const documentSessionContainer = document.getElementById('document-session-container');
    const $chatContainer = $('.chat-container');

     // Event listener for input container click to close sidebar
     $('#user-input').click(function() {
        // Check if sidebar is open and close it
        if ($('body').hasClass('sidebar-opened')) {
            $('body').removeClass('sidebar-opened');
            $('#open-sidebar-btn').show();
            $('.close-sidebar-btn').hide();
            adjustInputWidth(); // Adjust input width if needed
        }
    });
    function clearChatHistory() {
        $('#chat-messages').empty(); // Clear the chat messages container
        localStorage.removeItem('chatHistory'); // Remove chat history from local storage
    }

    // Event listener for the Clear History button click
    $('#clear-history-btn').click(function() {
        clearChatHistory(); // Call function to clear chat history
    });

    function handleAdditionalQuestionClick(question) {
        $userInput.val(question);
        sendMessage();
    }
    function appendAdditionalQuestion(question) {
    const additionalQuestionElement = $('<div class="additional-question"></div>').text(question);
    additionalQuestionElement.on('click', function() {
        $userInput.val(question);
        sendMessage();
    });
    $chatMessages.append(additionalQuestionElement);
    
    
}



    // Function to handle backend response
    function handleResponse(response) {
        const { response_text, additional_questions, audio_data, document_session } = response;

         // Display the response text in the chat interface
         appendMessage('assistant', response_text, 'response');
          // Check if audio data is available
    if (audio_data) {
        // Create an audio element
        const audioElement = document.createElement('audio');
        audioElement.setAttribute('controls', ''); // Add controls for playback
        audioElement.src = 'data:audio/wav;base64,' + audio_data; // Set audio source
        audioElement.style.display = 'none'; // Hide the audio player initially

        // Create a button to trigger audio playback
        const audioButton = document.createElement('button');
        audioButton.id = 'listen-btn'; // Set button id for styling

        // Create an image element for the button
        const audioImage = document.createElement('img');
        audioImage.src = '/static/img/WhatsApp Image 2024-05-22 at 02.14.16_6f498517.jpg'; // Set path to your image
        audioImage.alt = 'Listen to Audio'; // Set alt text for accessibility
        audioImage.style.width = '38px'; // Apply width style
        audioImage.style.height = '30px'; // Apply height style
        audioImage.style.marginRight = '0px'; // Apply margin-right style
        let isPlaying = false; // Track whether audio is currently playing
        audioButton.appendChild(audioImage); // Append the image to the button
        audioButton.addEventListener('click', function() {
            if (!isPlaying) {
                audioElement.play(); // Start audio playback
                audioImage.src = '/static/img/WhatsApp Image 2024-05-22 at 02.14.16_6f498517.jpg'; // Change image to "Pause the Audio"
                audioImage.alt = 'Pause the Audio'; // Change alt text
                isPlaying = true; // Set isPlaying to true
            } else {
                audioElement.pause(); // Pause audio playback
                audioImage.src = '/static/img/WhatsApp Image 2024-05-22 at 02.14.16_6f498517.jpg'; // Change image back to "Listen to Audio"
                audioImage.alt = 'Listen to Audio'; // Change alt text
                isPlaying = false; // Set isPlaying to false
            }
        });



        // Append the audio button and audio element to the chat interface
        $chatMessages.append(audioButton);
        $chatMessages.append(audioElement);
        scrollChatContainerToBottom();
    }
    
   
    
        
       if (additional_questions && additional_questions.length > 0) {
            additional_questions.forEach((question) => {
                appendAdditionalQuestion(question);
            });
        }


 // Create a button element
const button = document.createElement('button');
button.innerHTML = '<img src="/static/img/png-transparent-computer-icons-book-book-cover-angle-recycling-logo-thumbnail-removebg-preview.png" alt="Reference" style="width:30px;height: 30px;">';

// Variable to keep track of the document session display state
let isDocumentSessionVisible = false;
let documentSessionElement = null;

button.addEventListener('click', function() {
    if (isDocumentSessionVisible) {
        // Hide the document session content
        if (documentSessionElement) {
            documentSessionElement.remove();
            documentSessionElement = null;
        }
    } else {
        // Display the document session content in the response area
        if (document_session) {
            documentSessionElement = document.createElement('div');
            documentSessionElement.classList.add('response');
            documentSessionElement.textContent = document_session;
            $chatMessages.append(documentSessionElement);
        }
    }
    // Toggle the document session display state
    isDocumentSessionVisible = !isDocumentSessionVisible;
});

// Apply CSS styles to the button
button.style.background = 'none';
button.style.border = 'none';
button.style.padding = '0';
button.style.cursor = 'pointer';

// Append the button to the chat interface
$chatMessages.append(button);
 // Handle additional questions, document session, etc.


// Function to scroll chat container to bottom
function scrollChatContainerToBottom() {
    $chatContainer.scrollTop($chatContainer[0].scrollHeight);
}
    
    } 

    // Function to send user message to the backend and handle response
    function sendMessageToBackend(message) {
        // Show loading animation
    $('#loading-animation').show();
        $.ajax({
            type: 'POST',
            url: '/chat', // Backend endpoint URL
            contentType: 'application/json',
            data: JSON.stringify({ user_question: message }),
            success: function(response) {
                 // Hide loading animation
            $('#loading-animation').hide();
                handleResponse(response);
            },
            error: function(xhr, status, error) {
                console.error('Error sending message:', error);
                 // Hide loading animation in case of error
            $('#loading-animation').hide();
            }
        });
    }
    // Function to toggle between voice and send buttons based on input value
    function toggleButtons() {
        const inputValue = $userInput.val().trim();
        if (inputValue !== '') {
            $voiceButton.hide();
            $sendButton.show();
        } else {
            $voiceButton.show();
            $sendButton.hide();
        }
    }

    // Event listener for input change
    $userInput.on('input', function() {
        toggleButtons(); // Toggle buttons based on input value
    });

    // Event listener for form submission (send button)
    $('#chat-form').submit(function(event) {
        event.preventDefault();
        const userQuestion = $userInput.val().trim();
        if (userQuestion !== '') {
            appendMessage('user', userQuestion, 'user');
            sendMessageToBackend(userQuestion);
            $userInput.val('');
            toggleButtons(); // Toggle buttons after sending message
        }
    });

    // Function to save chat history in local storage
function saveChatHistory(role, message) {
    let chatHistory = JSON.parse(localStorage.getItem('chatHistory')) || [];
    chatHistory.push({ role, text: message });
    localStorage.setItem('chatHistory', JSON.stringify(chatHistory));
}


    // Function to append message to chat interface with specific message type
    function appendMessage(role, message, type) {
        let messageElement;
        if (type === 'user') {
            messageElement = `<div id="user-message" class="chat-message">${message}</div>`;
        } else if (type === 'response') {
            messageElement = `<div id="response-message" class="chat-message">${message}</div>`;
        } else if (type === 'additional_question') {
            messageElement = `<div id="additional-question" class="chat-message">${message}</div>`;
        } else {
            // Default message style
            messageElement = `<div class="chat-message">${message}</div>`;
        }

        $chatMessages.append(messageElement);
        saveChatHistory(role, message); // Save message to chat history
        // Scroll chat container to bottom
    scrollChatContainerToBottom();
    
    }
    // Function to scroll chat container to bottom
function scrollChatContainerToBottom() {
    $chatContainer.scrollTop($chatContainer[0].scrollHeight);
}
   
    // Voice command button click event
    $('#voice-command-button').click(function() {
        voiceCommand(); // Call the voiceCommand function
    });

    // Function for voice command
    function voiceCommand() {
        var recognition = new webkitSpeechRecognition();
        recognition.lang = 'en-US';
        recognition.onresult = function(event) {
            var transcript = event.results[0][0].transcript;
            $userInput.val(transcript);
            $('#input').submit(); // Submit the form after setting the input value
        };
        recognition.start();
    }
     // Function to show chat history
     function showChatHistory() {
            // Assuming this function displays chat history (not defined in the provided code)
        }

        // Function to start a new chat and refresh the page
        function newChat() {
            location.reload(); // Reload the page
        }
        
        

        // Open sidebar button click event
        $('#open-sidebar-btn').click(function() {
            $('body').addClass('sidebar-opened');
            $('#open-sidebar-btn').hide();
            $('.close-sidebar-btn').show();
            adjustInputWidth();
        });

        // Close sidebar button click event
        $('.close-sidebar-btn').click(function() {
            $('body').removeClass('sidebar-opened');
            $('#open-sidebar-btn').show();
            $('.close-sidebar-btn').hide();
            adjustInputWidth();
        });

        // Automatically close sidebar when the page loads
        $('body').removeClass('sidebar-opened');
        $('#open-sidebar-btn').show();
        $('.close-sidebar-btn').hide();
        adjustInputWidth(); // Assuming this function is defined elsewhere
    }); 

</script>
</body>
</html>